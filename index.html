<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Розрахунок опосередкованного споживання системи відкатних воріт</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="GateCalc">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">

<link rel="manifest" href="manifest.json">

<style>
/* --- Светлая тема --- */
:root{
  --bg:#f2f4f7;
  --card:#ffffff;
  --accent:#0066ff;

  --text:#000000;
  --text-muted:#6b6b6b;

  --border:#d8dce3;
  --panel-border:#e7e9ee;
  --divider:#eee;

  --good:#0c7a27;
  --bad:#a80000;

  --grey:#777;
  
  --zero-bg:#f4f4f4;
  --zero-border:#ccc;
}

/* --- Тёмная тема --- */
.dark-theme{
  --bg:#121212;
  --card:#1f1f1f;
  --accent:#5599ff;

  --text:#f0f0f0;
  --text-muted:#cccccc;

  --border:#333;
  --panel-border:#2e2e2e;
  --divider:#333;

  --good:#5fb371;
  --bad:#ff7575;

  --grey:#a0a0a0;

  --zero-bg:#2d2d2d;
  --zero-border:#444;
}

/* --- Базовые стили --- */
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg);
  margin:0;
  padding:0;
  color:var(--text);
}

a{ color:var(--accent); text-decoration:underline; }

.wrap{max-width:600px;margin:0 auto;padding:16px;}
h1{text-align:center;margin:0 0 16px;font-size:22px;font-weight:700;}

.card{
  background:var(--card);
  border-radius:16px;
  padding:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.06);
  margin-bottom:16px;
}

.dark-theme .card{
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
}

label{font-size:15px;color:var(--text-muted);margin-bottom:6px;display:block;}

input[type="number"]{
  width:100%;padding:14px 12px;font-size:18px;
  border-radius:12px;border:1px solid var(--border);
  background:var(--card);color:var(--text);
  margin-bottom:12px;box-sizing:border-box;
}

input[type="number"]:focus{
  outline:none;border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(0,102,255,0.2);
}

.button-row{
  display:flex;gap:10px;align-items:center;
}

.btn{
  width:100%;padding:14px;border-radius:12px;
  background:var(--accent);border:0;color:white;
  font-size:18px;font-weight:600;flex-grow:1;
}

.small-icon-btn{
  padding:14px;border-radius:12px;border:0;
  color:white;cursor:pointer;flex-shrink:0;
}

.small-icon-btn.red{background:var(--bad);}

/* --- Результаты --- */
/* По умолчанию — серый до расчёта */
.val, .diff{
  color:var(--grey);
}

.good-result{ color:var(--good) !important; }
.bad-result{ color:var(--bad) !important; }

.panel{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  border:1px solid var(--panel-border);
}

.panel h3{margin:0 0 10px;font-size:18px;}

.line{
  display:flex;justify-content:space-between;
  padding:8px 0;font-size:16px;
  border-top:1px solid var(--divider);
}

.line:first-of-type{
  border-top:0;padding-top:0;
}

textarea{
  width:100%;margin:10px 0;height:140px;
  border-radius:10px;padding:10px;
  font-size:14px;border:1px solid var(--border);
  background:var(--card);color:var(--text);
  box-sizing:border-box;
}

.small-btn{
  padding:8px 12px;border-radius:8px;border:0;
  background:var(--zero-bg);color:var(--text);cursor:pointer;
}

/* --- Toggle --- */
.switch{
  position:relative;display:inline-block;width:50px;height:28px;
}
.switch input{opacity:0;width:0;height:0;}

.slider{
  position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;
  transition:.4s;border-radius:28px;
  background-color:var(--zero-bg);border:1px solid var(--zero-border);
}

.slider:before{
  content:"";position:absolute;height:20px;width:20px;left:4px;bottom:3px;
  background:white;border-radius:50%;
  transition:.4s;box-shadow:0 1px 3px rgba(0,0,0,0.2);
}

input:checked + .slider{
  background-color:var(--accent);border-color:var(--accent);
}
input:checked + .slider:before{transform:translateX(20px);}

#extraFields{
  overflow:hidden;max-height:0;padding:0;
  transition:max-height .35s ease,padding .25s ease;
}
#extraFields.open{max-height:300px;padding:10px 0;}
</style>
</head>

<body>
<div class="wrap">
  <h1>Розрахунок опосередкованного споживання системи відкатних воріт</h1>

  <div class="card">
    <label class="toggle-row" style="display:flex;justify-content:space-between;align-items:center;">
      <span>Темна тема</span>
      <label class="switch" style="margin:0">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </label>
  </div>

  <div class="card">
    <label>Потужність пристрою в режимі очікування*, Вт</label>
    <input id="potugnist_o4ikuvannya" type="number" inputmode="decimal" value="3">
    <label>
  *Характеристики нашого пристрою в режимі очикування не знайдено,
  але є характеристики аналога по потужності 
  <a href="https://alutech.ua/avtomatika/dlya-otkatnyh-vorot/privod-dlya-otkatnykh-vorot-roteo-rto-500m/">
    ROTEO RTO-500M
  </a>
    </label>
    <br>

    <label>Потужність двигуна, Вт</label>
    <input id="potugnist_dvyguna" type="number" inputmode="decimal" step="0.01" value="250">
    <br>
      
    <label>Час відкриття воріт, секунд</label>
    <input id="t_vidkryttya" type="number" inputmode="decimal" step="0.01" value="20">
    <br>
      
    <label>Час закриття воріт, секунд</label>
    <input id="t_zakryttya" type="number" inputmode="decimal" step="0.01" value="20">
    <br>
      
    <label>Інтенсивність використання</label>
    <label>Опосередкована кількість циклів (відкриття-закриття) на добу</label>
    <input id="kvo_zykliv" type="number" inputmode="decimal" step="0.01" value="10">
    <br>
      
    <label>Розрахунковий період</label>
    <label>Кількість місяців</label>
    <input id="period" type="number" inputmode="decimal" step="0.01" value="1">
    <br>
      
    <label>Вартість електроенергії</label>
    <label>Тариф вартості 1 кВт*год, грн**</label>
    <input id="tarif" type="number" inputmode="decimal" step="0.01" value="4.32">
    <label>**1 жовтня 2021 – 31 травня 2023; 1,44 грн/кВт·год (до 250 кВт·год/місяць) та 1,68 грн/кВт·год (більше 250 кВт·год) 
    <br>
      1 червня 2023 – 31 травня 2024; 2,64 грн/кВт·год (єдиний тариф)
    <br>
      1 червня 2024 – 31 жовтня 2025; 4,32 грн/кВт·год (єдиний тариф)
    <br>
      з 1 листопада 2025 ; 4,32 грн/кВт·год (денний тариф) та 2,16 грн/кВт·год (нічний тариф)</label>
    <br>

    <label class="toggle-row" style="display:flex;justify-content:space-between;align-items:center;">
      <span>Додаткові параметри</span>
      <label class="switch" style="margin:0">
        <input type="checkbox" id="extraToggle">
        <span class="slider"></span>
      </label>
    </label>

    <div id="extraFields">
      <label>Потужність лічильника, Вт</label>
      <input id="potugnist_li4ilnyka" type="number" step="1" placeholder="необов’язково, до 1 Вт">
    </div>

    <div class="button-row">
      <button class="small-icon-btn red" 
        id="clearBtn" 
        title="Очистити"
        type="button" 
        onclick="window.location.reload()">
    
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M16 9v10H8V9h8m-1.5-6h-5L9 4H7v2h10V4h-2l-1.5-3zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/>
          </svg>
      </button>

      <button class="btn" id="calcBtn">Розрахувати</button>
    </div>
  </div>

  <div class="panel">
    <h3>Розрахунок</h3>
    <div class="line"><span>Розрахункова сума</span><span class="val" id="suma">—</span></div>
    <div class="line"><span>Розрахункове споживання</span><span class="diff" id="spogyvannya">—</span></div>
    <textarea id="stdMsg" placeholder="Деталізація розрахунків зʼявиться тут"></textarea>
    <button class="small-btn" id="copyStd">Копіювати</button>
  </div>
</div>

<script>
document.getElementById("calcBtn").onclick = function(){
  const potugnist_o4ikuvannya = parseFloat(document.getElementById("potugnist_o4ikuvannya").value) || 0;
  const potugnist_dvyguna = parseFloat(document.getElementById("potugnist_dvyguna").value) || 0;
  const t_vidkryttya = parseFloat(document.getElementById("t_vidkryttya").value) || 0;
  const t_zakryttya = parseFloat(document.getElementById("t_zakryttya").value) || 0;
  const kvo_zykliv = parseFloat(document.getElementById("kvo_zykliv").value) || 0;
  const period = parseFloat(document.getElementById("period").value) || 0;
  const tarif = parseFloat(document.getElementById("tarif").value) || 0;
  const potugnist_li4ilnyka = parseFloat(document.getElementById("potugnist_li4ilnyka").value) || 0;
  
  // Валидация: проверяем основные поля
  if(isNaN(tarif) || isNaN(potugnist_o4ikuvannya) || isNaN(potugnist_dvyguna) || isNaN(t_vidkryttya) || isNaN(t_zakryttya) || isNaN(kvo_zykliv) || isNaN(period)){
    alert("Пожалуйста, введите корректные числовые данные во все основные поля для расчета.");
    return;
  }
  
  const spogyvannya_o4ikuvannya = (potugnist_o4ikuvannya / 1000) * (period * 30 * 24); 
  const spogyvannya_dvyguna = (potugnist_dvyguna / 1000) * (((t_vidkryttya + t_zakryttya) * kvo_zykliv * 30 * period) / 3600); 
  const spogyvannya_li4ilnyka = (potugnist_li4ilnyka / 1000) * (period * 30 * 24);

  const spogyvannya = spogyvannya_o4ikuvannya + spogyvannya_dvyguna + spogyvannya_li4ilnyka;
  const suma = spogyvannya * tarif;

  // Обновляем DOM: сохраняем исходные классы, но применяем нужные цвета
  const sumaEl = document.getElementById("suma");
  sumaEl.textContent = suma.toFixed(2) + " ₴";
  sumaEl.className = "val good-result";

  const spogyvannyaEl = document.getElementById("spogyvannya");
  spogyvannyaEl.textContent = spogyvannya.toFixed(3) + " кВт⋅год";
  spogyvannyaEl.className = "diff bad-result";

  // Детализация расчёта
  const resultMessage = `Розрахункове споживання за ${period} місяць(ів):
  
1. Споживання пристрою в режимі очікування (Плата ${potugnist_o4ikuvannya} Вт, 24/7): 
   Формула: (Потужність / 1000) * (Період * 30 * 24)
   Розрахунок: (${potugnist_o4ikuvannya} / 1000) * (${period} * 30 * 24) = ${spogyvannya_o4ikuvannya.toFixed(3)} кВт⋅год

2. Споживання двигуна (${potugnist_dvyguna} Вт, під час руху):
   Формула: (Потужність / 1000) * ((Т_откр + Т_закр) * Цикли * 30 * Період / 3600)
   Розрахунок: (${potugnist_dvyguna} / 1000) * ((${t_vidkryttya} + ${t_zakryttya}) * ${kvo_zykliv} * 30 * ${period} / 3600) = ${spogyvannya_dvyguna.toFixed(3)} кВт⋅год
   
${potugnist_li4ilnyka > 0 ? `3. Споживання лічильника (${potugnist_li4ilnyka} Вт):
   Формула: (Потужність / 1000) * (Період * 30 * 24)
   Розрахунок: (${potugnist_li4ilnyka} / 1000) * (${period} * 30 * 24) = ${spogyvannya_li4ilnyka.toFixed(3)} кВт⋅год` : ''}
   
4. Загальне споживання:
   Формула: Очікування + Двигун + Лічильник
   Розрахунок: ${spogyvannya_o4ikuvannya.toFixed(3)} + ${spogyvannya_dvyguna.toFixed(3)} + ${potugnist_li4ilnyka > 0 ? spogyvannya_li4ilnyka.toFixed(3) : 0} = ${spogyvannya.toFixed(3)} кВт⋅год

5. Орієнтовна вартість:
   Формула: Загальне споживання * Тариф
   Розрахунок: ${spogyvannya.toFixed(3)} * ${tarif.toFixed(2)} = ${suma.toFixed(2)} грн
   
Загальна сума: ${suma.toFixed(2)} ₴
  `;
  
  document.getElementById('stdMsg').value = resultMessage;
};

// Показ/скрытие доп. полей
document.getElementById('extraToggle').addEventListener('change', function () {
  const extra = document.getElementById('extraFields');
  const li4Input = document.getElementById('potugnist_li4ilnyka');

  if (this.checked) {
    extra.classList.add('open');
  } else {
    extra.classList.remove('open');
    li4Input.value = '';
  }
});

// Тема — исправленный селектор (класс висит на body)
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
const THEME_KEY = 'uklonTheme';

// Установка начальной темы
function setInitialTheme() {
  const savedTheme = localStorage.getItem(THEME_KEY);
  if (savedTheme === 'dark') {
    body.classList.add('dark-theme');
    themeToggle.checked = true;
  }
}
themeToggle.addEventListener('change', function () {
  if (this.checked) {
    body.classList.add('dark-theme');
    localStorage.setItem(THEME_KEY, 'dark');
  } else {
    body.classList.remove('dark-theme');
    localStorage.setItem(THEME_KEY, 'light');
  }
});
setInitialTheme();

// Регистрация service worker (PWA)
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('Service Worker зареєстрований'))
    .catch(err => console.log('Service Worker помилка:', err));
}
</script>
</body>
</html>