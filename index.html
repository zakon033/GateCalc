<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Розрахунок опосередкованного споживання системи відкатних воріт</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="GateCalc">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">

<link rel="manifest" href="manifest.json">

<style>
  /* --- ПЕРЕМЕННЫЕ ПО УМОЛЧАНИЮ (СВЕТЛАЯ ТЕМА) --- */
  :root{
    /* Основные цвета */
    --bg:#f2f4f7;
    --card:#ffffff;
    --accent:#0066ff;
    
    /* Тексты */
    --main-text:#000000;
    --muted-text:#6b6b6b; 
    
    /* Границы и разделители */
    --border-color:#d8dce3;
    --panel-border:#e7e9ee;
    --line-divider:#eee;
    
    /* Цвета состояний */
    --green:#c8f5c2;
    --red:#ffd4d4;
    --good:#0c7a27;
    --bad:#a80000;
    
    /* Элементы .zero */
    --zero-bg:#f4f4f4;
    --zero-border:#ccc;
    --zero-text:#555;
    --small-btn-bg:#eee;
  }

  /* --- ПЕРЕМЕННЫЕ ДЛЯ ТЕМНОЙ ТЕМЫ --- */
  .dark-theme{
    /* Основные цвета */
    --bg:#121212;
    --card:#1f1f1f;
    --accent:#5599ff;
    
    /* Тексты */
    --main-text:#f0f0f0;
    --muted-text:#ffffff; 
    
    /* Границы и разделители */
    --border-color:#333;
    --panel-border:#2e2e2e;
    --line-divider:#333;
    
    /* Цвета состояний */
    --green:#1a3a1f; 
    --red:#472c2c; 
    --good:#5fb371; 
    --bad:#ff7575; 
    
    /* Элементы .zero */
    --zero-bg:#2d2d2d;
    --zero-border:#444;
    --zero-text:#a0a0a0;
    --small-btn-bg:#333;
  }
  
  /* --- БАЗОВЫЕ СТИЛИ (Одинаковые для обеих тем) --- */
  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
    background:var(--bg);
    margin:0;
    padding:0;
    color: var(--main-text); 
  }
  
  a {
    color: var(--accent);
    text-decoration: underline; 
  }

  
  /* Применяем основные стили для тёмной темы, когда класс установлен */
  .dark-theme body {
    background: var(--bg);
    color: var(--main-text);
  }

  .wrap{max-width:600px;margin:0 auto;padding:16px;}
  h1{text-align:center;margin:0 0 16px;font-size:22px;font-weight:700;}

  .card{
    background:var(--card);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
  }

  /* Для темной темы тени нужно сделать менее заметными */
  .dark-theme .card {
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  label{font-size:15px;color:var(--muted-text);margin-bottom:6px;display:block;}

  input[type="number"]{
    width:100%;
    padding:14px 12px;
    font-size:18px;
    border-radius:12px;
    border:1px solid var(--border-color);
    margin-bottom:12px;
    box-sizing:border-box;
    background: var(--card);
    color: var(--main-text);
  }

  input[type="number"]:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(0,102,255,0.2);
  }

  /* --- СТИЛИ ДЛЯ РЯДА КНОПОК --- */
  .button-row {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .btn{
    width:100%;
    padding:14px;
    border-radius:12px;
    background:var(--accent);
    border:0;
    color:white;
    font-size:18px;
    font-weight:600;
    flex-grow: 1; 
  }
  
  .small-icon-btn {
    padding: 14px;
    border-radius: 12px;
    border: 0;
    color: white; 
    cursor: pointer;
    flex-shrink: 0; 
  }
  .small-icon-btn.red {
    background: var(--bad); 
  }
  .small-icon-btn svg {
    display: block;
  }
  /* --- КОНЕЦ СТИЛЕЙ ДЛЯ РЯДА КНОПОК --- */

  .results{display:flex;flex-direction:column;gap:16px;}

  .panel{
    background:var(--card);
    border-radius:16px;
    padding:16px;
    border:1px solid var(--panel-border);
  }

  .panel h3{margin:0 0 10px;font-size:18px;}

  .line{
    display:flex;
    justify-content:space-between;
    padding:8px 0;
    font-size:16px;
    border-top:1px solid var(--line-divider);
  }
  .line:first-of-type{border-top:0;padding-top:0;}

  .val{font-weight:700;}

  .diff{
    padding:6px 12px;
    border-radius:10px;
    min-width:90px;
    text-align:center;
    display:inline-block;
    font-weight:600;
  }

  .zero{
    background:var(--zero-bg);
    border:1px dashed var(--zero-border);
    color:var(--zero-text);
  }

  /* --- СТИЛИ ДЛЯ ЦВЕТНОГО ФОНА РЕЗУЛЬТАТОВ --- */
  .good {
    background: var(--green);
    color: var(--good);
    border: 1px solid var(--good);
  }

  .bad {
    background: var(--red);
    color: var(--bad);
    border: 1px solid var(--bad);
  }
  /* ------------------------------------------- */

  textarea{
    width: 100%;
    margin: 10px 0;
    height: 360px;
    border-radius: 10px;
    padding: 10px;
    font-size: 14px;
    border: 1px solid var(--border-color);
    box-sizing: border-box;
    display: block;
    background: var(--card);
    color: var(--main-text);
  }

  .row{display:flex;gap:10px;}
  .small-btn{
    padding:8px 12px;
    border-radius:8px;
    border:0;
    background:var(--small-btn-bg);
    color: var(--main-text);
    cursor:pointer;
  }
  
  /* --- Стили для дополнительных параметров и переключателей --- */
  .toggle-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0 6px;
    font-size: 16px;
  }

  #extraFields {
    overflow: hidden;
    max-height: 0;
    padding: 0;
    transition: max-height 0.35s ease, padding 0.25s ease;
  }

  #extraFields.open {
    max-height: 300px;
    padding: 10px 0;
  }

  #extraFields label {
    display: block;
    margin: 8px 0 4px;
  }

  #extraFields input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid var(--border-color);
    font-size: 16px;
    box-sizing: border-box;
    background: var(--card);
    color: var(--main-text);
  }
  
  /* --- CSS ДЛЯ КАСТОМНОГО СЛАЙДЕРА (TOGGLE SWITCH) --- */
  .switch {
    position: relative;
    display: inline-block;
    width: 50px; 
    height: 28px; 
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    transition: .4s;
    border-radius: 28px;
    background-color: var(--zero-bg); 
    border: 1px solid var(--zero-border);
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 3px;
    background-color: white; 
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }

  /* Активное состояние */
  input:checked + .slider {
    background-color: var(--accent);
    border-color: var(--accent);
  }

  input:checked + .slider:before {
    transform: translateX(20px);
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Розрахунок опосередкованного споживання системи відкатних воріт</h1>

  <div class="card">
    <label class="toggle-row">
      <span>Темна тема</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </label>
  </div>

  <div class="card">
    <label>Потужність пристрою в режимі очікування*, Вт</label>
    <input id="potugnist_o4ikuvannya" type="number" inputmode="decimal" value="4">
    <label>
  *Характеристики нашого пристрою в режимі очикування не знайдено,
  але є характеристики аналога по потужності 
  <a href="https://alutech.ua/avtomatika/dlya-otkatnyh-vorot/privod-dlya-otkatnykh-vorot-roteo-rto-500m/">
    ROTEO RTO-500M https://alutech.ua/avtomatika/dlya-otkatnyh-vorot/privod-dlya-otkatnykh-vorot-roteo-rto-500m/
  </a>
    </label>
    <br>

    <label>Потужність двигуна, Вт</label>
    <input id="potugnist_dvyguna" type="number" inputmode="decimal" step="0.01" value="250">
    <br>
      
    <label>Час відкриття воріт, секунд</label>
    <input id="t_vidkryttya" type="number" inputmode="decimal" step="0.01" value="20">
    <br>
      
    <label>Час закриття воріт, секунд</label>
    <input id="t_zakryttya" type="number" inputmode="decimal" step="0.01" value="20">
    <br>
      
    <label>Інтенсивність використання</label>
    <label>Опосередкована кількість циклів (відкриття-закриття) на добу</label>
    <input id="kvo_zykliv" type="number" inputmode="decimal" step="0.01" value="10">
    <br>
      
    <label>Розрахунковий період</label>
    <label>Кількість місяців</label>
    <input id="period" type="number" inputmode="decimal" step="0.01" value="1">
    <br>
      
    <label>Вартість електроенергії</label>
    <label>Тариф вартості 1 кВт*год, грн**</label>
    <input id="tarif" type="number" inputmode="decimal" step="0.01" value="4.32">
    <label>**1 жовтня 2021 – 31 травня 2023; 1,44 грн/кВт·год (до 250 кВт·год/місяць) та 1,68 грн/кВт·год (більше 250 кВт·год) 
    <br>
      1 червня 2023 – 31 травня 2024; 2,64 грн/кВт·год (єдиний тариф)
    <br>
      1 червня 2024 – 31 жовтня 2025; 4,32 грн/кВт·год (єдиний тариф)
    <br>
      з 1 листопада 2025 ; 4,32 грн/кВт·год (денний тариф) та 2,16 грн/кВт·год (нічний тариф)</label>
    <br>


    <label class="toggle-row">
      <span>Додаткові параметри</span>
      <label class="switch">
        <input type="checkbox" id="extraToggle">
        <span class="slider"></span>
      </label>
    </label>

    <div id="extraFields">
      <label>Потужність лічильника, Вт</label>
      <input id="potugnist_li4ilnyka" type="number" step="1" placeholder="необов’язково, до 1 Вт">
    </div>

    <div class="button-row">
      <button class="small-icon-btn red" 
        id="clearBtn" 
        title="Очистити"
        type="button">
    
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M16 9v10H8V9h8m-1.5-6h-5L9 4H7v2h10V4h-2l-1.5-3zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/>
          </svg>
      </button>

      <button class="btn" id="calcBtn">Розрахувати</button>
    </div>
  </div>

  <div class="results">
    <div class="panel">
      <h3>Розрахунок</h3>
      <div class="line"><span>Розрахункова сума</span><span class="diff zero" id="suma">—</span></div>
      <div class="line"><span>Розрахункове споживання</span><span class="diff zero" id="spogyvannya">—</span></div>
      <textarea id="stdMsg" placeholder="Деталізація розрахунків зʼявиться тут"></textarea>
      <button class="small-btn" id="copyStd">Копіювати</button>
    </div>

  </div>
</div>

<script>

// --- ФУНКЦИЯ ЦВЕТОВОЙ ИНДИКАЦИИ (РАБОЧИЙ МЕТОД) ---
function colorize(el, v){
  // 1. Сбрасываем все стили и классы, оставляя только "diff"
  el.className = "diff";
  el.style.background = ""; 
  el.style.color = ""; 
  el.style.border = ""; 

  // 2. Если значение не число или равно 0, устанавливаем серый (zero) вид
  if(isNaN(v) || v === 0){
    el.classList.add("zero");
    el.textContent = "—";
    return;
  }

  // 3. Вывод значения с правильной единицей измерения
  if (el.id === 'suma') {
      el.textContent = v.toFixed(2) + " ₴";
  } else if (el.id === 'spogyvannya') {
      el.textContent = v.toFixed(3) + " кВт⋅год";
  } else {
      el.textContent = v.toFixed(2); 
  }

  // 4. Логика цвета (прямая стилизация)
  if(el.id === 'suma'){
      // СУММА: Считаем сумму "ХОРОШИМ" результатом (зеленый фон)
      el.style.background = "var(--green)";
      el.style.color = "var(--good)";
      el.style.border = "1px solid var(--good)";
  }
  else if(el.id === 'spogyvannya'){
      // ПОТРЕБЛЕНИЕ: Считаем потребление "ПЛОХИМ" результатом (красный фон)
      el.style.background = "var(--red)";
      el.style.color = "var(--bad)";
      el.style.border = "1px solid var(--bad)";
  }
}
// -----------------------------------------------------------------


document.getElementById("calcBtn").onclick = function(){
  // --- 1. СБОР ВВОДНЫХ ДАННЫХ ---
  const potugnist_o4ikuvannya = parseFloat(document.getElementById("potugnist_o4ikuvannya").value) || 0;
  const potugnist_dvyguna = parseFloat(document.getElementById("potugnist_dvyguna").value) || 0;
  const t_vidkryttya = parseFloat(document.getElementById("t_vidkryttya").value) || 0;
  const t_zakryttya = parseFloat(document.getElementById("t_zakryttya").value) || 0;
  const kvo_zykliv = parseFloat(document.getElementById("kvo_zykliv").value) || 0;
  const period = parseFloat(document.getElementById("period").value) || 0;
  const tarif = parseFloat(document.getElementById("tarif").value) || 0;
  const potugnist_li4ilnyka = parseFloat(document.getElementById("potugnist_li4ilnyka").value) || 0;
  
  if(isNaN(tarif) || isNaN(potugnist_o4ikuvannya) || isNaN(potugnist_dvyguna) || isNaN(t_vidkryttya) || isNaN(t_zakryttya) || isNaN(kvo_zykliv) || isNaN(period)){
    alert("Пожалуйста, введите корректные числовые данные во все основные поля для расчета.");
    return;
  }
  
  // --- 2. РАСЧЕТЫ ---
  const spogyvannya_o4ikuvannya = (potugnist_o4ikuvannya / 1000) * (period * 30 * 24); 

  const spogyvannya_dvyguna = (potugnist_dvyguna / 1000) * (((t_vidkryttya + t_zakryttya) * kvo_zykliv * 30 * period) / 3600); 

  const spogyvannya_li4ilnyka = (potugnist_li4ilnyka / 1000) * (period * 30 * 24);

  const spogyvannya = spogyvannya_o4ikuvannya + spogyvannya_dvyguna + spogyvannya_li4ilnyka;

  const suma = spogyvannya * tarif;

  // --- 3. БЛОК ВЫВОДА РЕЗУЛЬТАТОВ (Стилизация) ---
  
  const sumaEl = document.getElementById("suma");
  const spogyvannyaEl = document.getElementById("spogyvannya");
  
  colorize(sumaEl, suma); 
  colorize(spogyvannyaEl, spogyvannya); 
  
  // ------------------------------------------------------------------------

  // --- 4. НОВАЯ ЛОГИКА ФОРМИРОВАНИЯ СООБЩЕНИЯ С ПРАВИЛЬНОЙ НУМЕРАЦИЕЙ ---
  
  let currentStep = 1;
  const details = [];

  // 1. Споживання очікування
  details.push(
    `${currentStep++}. Споживання пристрою в режимі очікування (${potugnist_o4ikuvannya} Вт, 24/7): 
   Формула: (Потужність / 1000) * (Період * 30 * 24)
   Розрахунок: (${potugnist_o4ikuvannya} / 1000) * (${period} * 30 * 24) = ${spogyvannya_o4ikuvannya.toFixed(3)} кВт⋅год`
  );

  // 2. Споживання двигуна
  details.push(
    `${currentStep++}. Споживання двигуна (${potugnist_dvyguna} Вт, під час руху):
   Формула: (Потужність / 1000) * ((Т_откр + Т_закр) * Цикли * 30 * Період / 3600)
   Розрахунок: (${potugnist_dvyguna} / 1000) * ((${t_vidkryttya} + ${t_zakryttya}) * ${kvo_zykliv} * 30 * ${period} / 3600) = ${spogyvannya_dvyguna.toFixed(3)} кВт⋅год`
  );

  // 3. Споживання лічильника (ДОПОЛНИТЕЛЬНЫЙ ПУНКТ)
  if (potugnist_li4ilnyka > 0) {
    details.push(
      `${currentStep++}. Споживання лічильника (${potugnist_li4ilnyka} Вт):
   Формула: (Потужність / 1000) * (Період * 30 * 24)
   Розрахунок: (${potugnist_li4ilnyka} / 1000) * (${period} * 30 * 24) = ${spogyvannya_li4ilnyka.toFixed(3)} кВт⋅год`
    );
  }

  // 4/5. Загальне споживання
  const stepTotal = currentStep++;
  details.push(
    `${stepTotal}. Загальне споживання:
   Формула: ${potugnist_li4ilnyka > 0 ? 'Очікування + Двигун + Лічильник' : 'Очікування + Двигун'}
   Розрахунок: ${spogyvannya_o4ikuvannya.toFixed(3)} + ${spogyvannya_dvyguna.toFixed(3)} ${potugnist_li4ilnyka > 0 ? `+ ${spogyvannya_li4ilnyka.toFixed(3)}` : ''} = ${spogyvannya.toFixed(3)} кВт⋅год`
  );

  // 5/6. Орієнтовна вартість
  details.push(
    `${currentStep}. Орієнтовна вартість:
   Формула: Загальне споживання * Тариф
   Розрахунок: ${spogyvannya.toFixed(3)} * ${tarif.toFixed(2)} = ${suma.toFixed(2)} грн`
  );
  
  // Собираем все части, используя двойной перевод строки для абзацев
  const resultMessage = `Розрахункове споживання за ${period} місяць(ів):
  
${details.join("\n\n")}
   
Загальна сума: ${suma.toFixed(2)} ₴
  `;
  
  document.getElementById('stdMsg').value = resultMessage;
};

// --- ФУНКЦИОНАЛ КНОПКИ "ОЧИСТИТЬ" (Сброс стилей) ---
document.getElementById("clearBtn").onclick = function(){
  // Очистка полей ввода
  document.getElementById("potugnist_o4ikuvannya").value = '3'; // Сброс до значений по умолчанию
  document.getElementById("potugnist_dvyguna").value = '250';
  document.getElementById("t_vidkryttya").value = '20';
  document.getElementById("t_zakryttya").value = '20';
  document.getElementById("kvo_zykliv").value = '10';
  document.getElementById("period").value = '1';
  document.getElementById("tarif").value = '4.32';
  document.getElementById("potugnist_li4ilnyka").value = '';
  
  // Сброс результатов и стилей с помощью colorize(el, 0)
  colorize(document.getElementById("suma"), 0); 
  colorize(document.getElementById("spogyvannya"), 0); 
  
  document.getElementById('stdMsg').value = '';
  
  // Сброс дополнительных полей
  const extraToggle = document.getElementById('extraToggle');
  const extraFields = document.getElementById('extraFields');
  if (extraToggle.checked) {
    extraToggle.checked = false;
    extraFields.classList.remove('open');
  }
};


document.getElementById('extraToggle').addEventListener('change', function () {
  const extra = document.getElementById('extraFields');
  const li4Input = document.getElementById('potugnist_li4ilnyka');

  if (this.checked) {
    extra.classList.add('open');
  } else {
    extra.classList.remove('open');
    li4Input.value = '';
  }
});


// --- ФУНКЦИОНАЛ КНОПКИ "КОПИРОВАТЬ" ---
document.getElementById("copyStd").onclick = function(){
    const t = document.getElementById('stdMsg');
    if(!t.value){
      alert('Немає повідомлення для копіювання');
      return;
    }
    t.select();
    t.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(t.value).then(
      () => alert('Скопійовано'),
      () => { document.execCommand('copy'); alert('Скопійовано'); }
    );
};


// --- ФУНКЦИОНАЛ ПЕРЕКЛЮЧЕНИЯ ТЕМЫ ---
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
const THEME_KEY = 'uklonTheme';

// 1. Установка начальной темы при загрузке
function setInitialTheme() {
  const savedTheme = localStorage.getItem(THEME_KEY);
  
  if (savedTheme === 'dark') {
    body.classList.add('dark-theme');
    themeToggle.checked = true;
  } 
}

// 2. Обработчик для переключателя
themeToggle.addEventListener('change', function () {
  if (this.checked) {
    // Включаем тёмную тему
    body.classList.add('dark-theme');
    localStorage.setItem(THEME_KEY, 'dark');
  } else {
    // Включаем светлую тему
    body.classList.remove('dark-theme');
    localStorage.setItem(THEME_KEY, 'light');
  }
});

// Вызываем функцию для установки темы после загрузки скрипта
setInitialTheme();


// PWA Service Worker registration
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('Service Worker зареєстрований'))
    .catch(err => console.log('Service Worker помилка:', err));
}
</script>
</body>
</html>
